# è¿æ¥ç¨³å®šæ€§æ”¹è¿›

## ğŸ¯ ç›®æ ‡
è§£å†³é¢‘ç¹å‡ºç°"disconnected"çš„é—®é¢˜ï¼Œæé«˜è¿æ¥ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ”§ ä¸»è¦æ”¹è¿›

### 1. å¿ƒè·³é…ç½®ä¼˜åŒ–
- **å¿ƒè·³é—´éš”**: 25ç§’ â†’ 15ç§’ï¼ˆæ›´é¢‘ç¹ï¼‰
- **è¶…æ—¶æ—¶é—´**: 35ç§’ â†’ 45ç§’ï¼ˆæ›´å®½æ¾ï¼‰
- **æœ€å¤§ä¸¢å¤±å¿ƒè·³**: 2æ¬¡ â†’ 3æ¬¡ï¼ˆæ›´å®½å®¹ï¼‰

### 2. Vercelå‡½æ•°è¶…æ—¶è°ƒæ•´
- **SSEå‡½æ•°**: 30ç§’ â†’ 60ç§’
- **å…¶ä»–APIå‡½æ•°**: 10ç§’ â†’ 30ç§’

### 3. SSEè¿æ¥è¶…æ—¶ä¼˜åŒ–
- **è¿æ¥è¶…æ—¶**: 60ç§’ â†’ 90ç§’ï¼ˆæ›´å®½æ¾ï¼‰

### 4. é‡è¿ç­–ç•¥æ”¹è¿›
- **æŒ‡æ•°é€€é¿**: ä½¿ç”¨1.5å€å¢é•¿è€Œä¸æ˜¯2å€
- **éšæœºæŠ–åŠ¨**: æ·»åŠ 0-1ç§’éšæœºå»¶è¿Ÿï¼Œé¿å…åŒæ—¶é‡è¿
- **æœ€å¤§é‡è¿å»¶è¿Ÿ**: 30ç§’

### 5. é¡µé¢å¯è§æ€§æ£€æµ‹
- æ£€æµ‹æµè§ˆå™¨æ ‡ç­¾é¡µåˆ‡æ¢
- é¡µé¢é‡æ–°å¯è§æ—¶è‡ªåŠ¨é‡è¿

### 6. è¿æ¥ç¨³å®šæ€§ç›‘æ§
- è·Ÿè¸ªè¿æ¥æ–­å¼€åŸå› 
- æä¾›ç¨³å®šæ€§æŠ¥å‘Š
- è®°å½•æ–­å¼€å†å²

## ğŸ“ æ›´æ–°çš„æ–‡ä»¶

### æ ¸å¿ƒé…ç½®
- `lib/heartbeat-manager.ts` - å¿ƒè·³é…ç½®ä¼˜åŒ–
- `vercel.json` - Vercelå‡½æ•°è¶…æ—¶è°ƒæ•´
- `app/api/sse/route.ts` - SSEè¶…æ—¶ä¼˜åŒ–

### è¿æ¥ç®¡ç†
- `lib/websocket-client.ts` - é‡è¿ç­–ç•¥æ”¹è¿›
- `lib/connection-manager.ts` - HTTPè½®è¯¢é‡è¿ä¼˜åŒ–
- `hooks/use-connection-manager-new.ts` - é¡µé¢å¯è§æ€§æ£€æµ‹

### ç›‘æ§å·¥å…·
- `lib/connection-stability-monitor.ts` - è¿æ¥ç¨³å®šæ€§ç›‘æ§å™¨
- `app/api/debug/stability/route.ts` - ç¨³å®šæ€§ç›‘æ§API
- `scripts/test-connection-stability.js` - è¿æ¥ç¨³å®šæ€§æµ‹è¯•è„šæœ¬

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æµ‹è¯•è¿æ¥ç¨³å®šæ€§
```bash
# æµ‹è¯•æœ¬åœ°ç¯å¢ƒ
node scripts/test-connection-stability.js

# æµ‹è¯•ç”Ÿäº§ç¯å¢ƒ
node scripts/test-connection-stability.js https://yuki-planning-poker.vercel.app
```

### 2. æŸ¥çœ‹ç¨³å®šæ€§æŠ¥å‘Š
```bash
# è·å–ç¨³å®šæ€§æŠ¥å‘Š
curl https://yuki-planning-poker.vercel.app/api/debug/stability

# è·å–æ–­å¼€å†å²
curl https://yuki-planning-poker.vercel.app/api/debug/stability?action=history

# æ¸…é™¤å†å²è®°å½•
curl https://yuki-planning-poker.vercel.app/api/debug/stability?action=clear
```

### 3. ç›‘æ§è¿æ¥çŠ¶æ€
åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æŸ¥çœ‹è¿æ¥æ—¥å¿—ï¼š
- è¿æ¥å»ºç«‹/æ–­å¼€
- é‡è¿å°è¯•
- é¡µé¢å¯è§æ€§å˜åŒ–

## ğŸ“Š é¢„æœŸæ•ˆæœ

### è¿æ¥ç¨³å®šæ€§æå‡
- å‡å°‘å› å¿ƒè·³è¶…æ—¶å¯¼è‡´çš„æ–­å¼€
- æ›´æ™ºèƒ½çš„é‡è¿ç­–ç•¥
- æ›´å¥½çš„ç½‘ç»œæ³¢åŠ¨å®¹é”™

### ç”¨æˆ·ä½“éªŒæ”¹å–„
- å‡å°‘"disconnected"æç¤º
- æ›´å¿«çš„è‡ªåŠ¨é‡è¿
- æ›´ç¨³å®šçš„å®æ—¶é€šä¿¡

### ç›‘æ§èƒ½åŠ›å¢å¼º
- è¯¦ç»†çš„è¿æ¥çŠ¶æ€è·Ÿè¸ª
- æ–­å¼€åŸå› åˆ†æ
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

## ğŸ” æ•…éšœæ’æŸ¥

### 1. æ£€æŸ¥å¿ƒè·³çŠ¶æ€
```bash
curl https://yuki-planning-poker.vercel.app/api/stats?category=heartbeat
```

### 2. æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
```bash
curl https://yuki-planning-poker.vercel.app/api/stats?category=connections
```

### 3. æ£€æŸ¥ç¨³å®šæ€§æŠ¥å‘Š
```bash
curl https://yuki-planning-poker.vercel.app/api/debug/stability?action=report
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**: ç¡®ä¿åœ¨Vercelä¸­è®¾ç½®äº†æ­£ç¡®çš„ç¯å¢ƒå˜é‡
2. **Redisè¿æ¥**: ç¡®ä¿RedisæœåŠ¡æ­£å¸¸è¿è¡Œ
3. **ç½‘ç»œç¯å¢ƒ**: åœ¨ç§»åŠ¨ç½‘ç»œæˆ–å¼±ç½‘ç¯å¢ƒä¸‹æµ‹è¯•
4. **æµè§ˆå™¨å…¼å®¹æ€§**: æµ‹è¯•ä¸åŒæµè§ˆå™¨çš„è¿æ¥è¡Œä¸º

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

1. **è‡ªé€‚åº”å¿ƒè·³**: æ ¹æ®ç½‘ç»œè´¨é‡åŠ¨æ€è°ƒæ•´å¿ƒè·³é—´éš”
2. **è¿æ¥è´¨é‡è¯„åˆ†**: åŸºäºå»¶è¿Ÿå’Œä¸¢åŒ…ç‡è¯„ä¼°è¿æ¥è´¨é‡
3. **æ™ºèƒ½é™çº§**: æ ¹æ®è¿æ¥è´¨é‡è‡ªåŠ¨é€‰æ‹©æœ€ä½³è¿æ¥æ–¹å¼
4. **ç”¨æˆ·é€šçŸ¥**: åœ¨è¿æ¥ä¸ç¨³å®šæ—¶é€šçŸ¥ç”¨æˆ· 